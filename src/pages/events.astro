---
import Layout from '@/components/Layout.astro';
import { Separator } from '@/components/ui/separator';

// all time are in british time, including daylight savings time

const events: {
  name: string;
  description: string;
  location: string;
  startDate?: Date;
  endDate?: Date;
}[] = [
  {
    name: 'Ball Making Social',
    description: 'We\'re making juggling balls, come along and make your own!',
    location: 'Slaidburn house',
    startDate: new Date('2025-10-03T09:00:00.000Z'),
    endDate: new Date('2025-10-03T11:00:00.000Z'),
  }, {
    name: 'Pendle Carnival',
    description: 'We\'re performing and jamming at Pendle College\'s Autumn Carnival',
    location: 'Pendle College',
    startDate: new Date('2025-10-03T11:00:00.000Z'),
    endDate: new Date('2025-10-03T18:00:00.000Z'),
  }, {
    name: 'Gaming Social',
    description: 'Come along to play games, eat some free food & meet your fellow clowns!',
    location: 'BLN SR2',
    startDate: new Date('2025-10-04T16:00:00.000Z'),
    endDate: new Date('2025-10-04T19:00:00.000Z'),
  }, {
    name: 'Picnic & Jamming',
    description: 'Join us for snacks and to try out our equipment! (Weather permitting)',
    location: 'County Square',
    startDate: new Date('2025-10-05T11:00:00.000Z'),
    endDate: new Date('2025-10-05T16:00:00.000Z'),
  }
].filter(({ endDate }) => {
  const now = new Date();
  return (!endDate || endDate > now);
});

const options = {
  month: 'long',
  day: 'numeric',
  hour: '2-digit',
  minute: '2-digit',
  hour12: false, // Use 24-hour format
  timeZone: 'Europe/London',
} satisfies Intl.DateTimeFormatOptions;

const formatter = new Intl.DateTimeFormat('en-UK', options);
---

<Layout
  title="Events"
  description="Events for the Lancaster University Magic and Circus Society (LUMACS)"
>
  <h1 class="text-2xl font-bold text-center">Events</h1>
  <p class="text-center max-w-2xl">
    These are the events and socials that we are either running or will be at.
  </p>
  {
    // sort by start date, if no start date put at end and filter out events that are more than a day in the past
    events.length < 1
      ? 'More events coming soon :)'
      : events
          .sort((a, b) => {
            if (a.startDate && b.startDate) {
              return a.startDate.getTime() - b.startDate.getTime();
            }
            if (a.startDate && !b.startDate) {
              return -1;
            }
            if (b.startDate) {
              return 1;
            }
            return 0;
          })
          .filter(({ startDate }) => startDate)
          .map(({ name, description, location, startDate, endDate }) => (
            <div class="flex flex-col items-center max-w-2xl text-center">
              <span class="font-bold text-xl">{name}</span>
              <span>{description}</span>
              <span class="text-sm text-center text-muted-foreground">
                {location}
              </span>
              <span class="text-sm text-center text-muted-foreground">
                {formatter.format(startDate)}{' '}
                {endDate && `- ${formatter.format(endDate)}`}
              </span>
            </div>
          ))
          .reduce(
            (acc, cur) => [...acc, <Separator className="my-2" />, cur],
            []
          )
  }
</Layout>
